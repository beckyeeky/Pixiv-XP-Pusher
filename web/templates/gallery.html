{% extends "base.html" %}

{% block title %}Gallery - Pixiv-XP-Pusher{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">ğŸ–¼ï¸ æ¨é€å†å²ç”»å»Š</h2>
        <span style="color: var(--text-secondary);">å…± {{ total }} å¼ ä½œå“</span>
    </div>

    {% if items %}
    <div class="gallery-grid">
        {% for item in items %}
        <div class="gallery-item">
            <!-- ä½¿ç”¨ wsrv.nl å…¨çƒå…è´¹å›¾åƒç¼“å­˜ä»£ç†ï¼Œå°†æºå›¾å®æ—¶ç¼©æ”¾å‹ç¼©ï¼ŒèŠ‚çœæµ·é‡å®¢æˆ·ç«¯å¸¦å®½ä¸å†…å­˜ -->
            <img src="https://wsrv.nl/?url=pixiv.cat/{{ item.illust_id }}.jpg&w=500&output=webp" 
                 onerror="this.onerror=null; this.src='https://pixiv.cat/{{ item.illust_id }}.jpg';" 
                 alt="Illust {{ item.illust_id }}" loading="lazy"
                 style="background: #2a2a3e;">
            <div class="overlay">
                <a href="https://www.pixiv.net/artworks/{{ item.illust_id }}" target="_blank">
                    #{{ item.illust_id }}
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- åˆ†é¡µ -->
    {% if total > limit %}
    {% set total_pages = (total // limit) + (1 if total % limit else 0) %}
    <div style="margin-top: 2rem; display: flex; flex-direction: column; align-items: center; gap: 1rem;">
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;">
            <a href="/gallery?page=1" class="btn" style="{% if page == 1 %}opacity: 0.5; pointer-events: none;{% endif %}">é¦–é¡µ</a>
            
            <a href="/gallery?page={{ page - 1 }}" class="btn" style="{% if page <= 1 %}opacity: 0.5; pointer-events: none;{% endif %}">ä¸Šä¸€é¡µ</a>
            
            <span style="display: inline-flex; align-items: center; padding: 0 1rem; background: var(--bg-secondary); border-radius: 6px; font-weight: 500;">
                {{ page }} / {{ total_pages }}
            </span>
            
            <a href="/gallery?page={{ page + 1 }}" class="btn" style="{% if page >= total_pages %}opacity: 0.5; pointer-events: none;{% endif %}">ä¸‹ä¸€é¡µ</a>
            
            <a href="/gallery?page={{ total_pages }}" class="btn" style="{% if page >= total_pages %}opacity: 0.5; pointer-events: none;{% endif %}">å°¾é¡µ</a>
        </div>
        
        <div style="display: flex; gap: 0.5rem; align-items: center;">
            <span style="color: var(--text-secondary); font-size: 0.9rem;">è·³è‡³</span>
            <input type="number" id="pageJump" min="1" max="{{ total_pages }}" value="{{ page }}" 
                   style="width: 60px; padding: 0.3rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: white; text-align: center;">
            <button onclick="jumpToPage()" class="btn" style="padding: 0.3rem 0.8rem;">Go</button>
        </div>
    </div>
    <script>
    function jumpToPage() {
        const input = document.getElementById('pageJump');
        let p = parseInt(input.value);
        if (p && p >= 1 && p <= {{ total_pages }}) {
            window.location.href = '/gallery?page=' + p;
        }
    }
    document.getElementById('pageJump').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') { jumpToPage(); }
    });
    </script>
    {% endif %}

    {% else %}
    <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">
        æš‚æ— æ¨é€è®°å½•ã€‚å‘é€ <code>/push</code> å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡æ¨é€å§ï¼
    </p>
    {% endif %}
</div>
{% endblock %}